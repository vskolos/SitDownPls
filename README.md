# Интернет-магазин SitDownPls

Итоговый проект курса «Веб-вёрстка. Продвинутый уровень». Задача: Сверстать страницы интернет-магазина **SitDownPls** по [техническому заданию](/SitDownPls%20(Objective).pdf).

## Сборка проекта

После клонирования репозитория необходимо установить все зависимости через команду:
```
npm i
```

### ImageMagick

Для обработки изображений используется дополнительная зависимость `imagemagick`, которая отсутствует в `npm`. Ее необходимо установить отдельно.

#### Ubuntu:

```
apt-get install imagemagick
```

#### Mac OS X (через Homebrew):

```
brew install imagemagick
```

#### Windows & прочее:

ImageMagick: http://www.imagemagick.org/script/binary-releases.php

Убедитесь, что ImageMagick установлен корректно, используя команду `convert -help` в терминале.

### Gulp

Проект использует Gulp для сборки. Создано две команды:

#### Сборка в режиме разработки:


```
npm run dev
```

В этом режиме прописываются `sourcemap`, а также запускается `browsersync` после сборки.

#### Сборка в режиме продакшна

```
npm run build
```

В этом режиме файлы минифицируются, `sourcemap` не прописываются, `browsersync` не запускается после сборки, а также не включается отслеживание папок на изменение/добавление файлов.

В обоих случаях собранный проект попадает в папку `dist`.

**Важно! Из-за генерации фавиконов на сервере через `RealFaviconGenerator` и обработки большого количества изображений сборка занимает некоторое время.**

Готовы три страницы:

```
index.html // Главная страница
catalog.html // Страница каталога
product.html // Страница товара
```

#### Очистка сборки

```
npm run clean
```

Эта команда удаляет папку `dist`.

## Особенности сборки

В процессе работы над проектом возникали неочевидные проблемы, некоторые из которых вылились в нестандартные (как мне кажется) решения.

### CommonJS vs ES Modules

Часть используемых библиотек, используемых в сборке, требовала использование модулей, из-за чего пришлось переписать весь gulp с синтаксисом модулей, и указать `"type": "module"` в `package.json`.

Однако, из-за этого возникла проблема с `ESLint` и `Prettier`, которые отказались работать в таком режиме, из-за чего долгое время код никак не форматировался, что я заметил только под конец разработки.

Нагуглил варианты, вроде `gulpfile.babel.js`, но несмотря на то, что `babel` у меня подключен, это решало только одну проблему из двух.

Итоговым решением стало исключение `"type": "module"` из `package.json` и переименование `gulpfile.js` в `gulpfile.mjs`. Так работает всё.

### Работа с картинками

Изначально я сохранял все изображения из figma сразу в `@1x` и `@2x` размерах. Однако на большом проекте это начало выматывать, поэтому я добавил `gulp-image-resize`, для которого, как раз, нужно было устанавливать `imagemagick`.

С его помощью я упростил себе задачу:
- В папке `src/img` находятся все изображения в размере `@2x`
- Эти изображения минифицируются и копируются в `dist/img` с добавлением `@2x` в конец названия
- Затем эти же изображения уменьшаются в 2 раза, минифицируются и копируются в `dist/img`
- После всего этого уже в папке `dist` они конвертируются в `webp`

Это позволило сохранять из фигмы в 2 раза меньше изображений.
